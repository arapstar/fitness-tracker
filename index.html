<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .today-section {
            background: #f9fafb;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .today-header {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .editing-hint {
            font-size: 0.8em;
            font-weight: 400;
            color: #888;
            margin-top: 4px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 0.95em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .option-button {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.2s ease;
            color: #666;
        }

        .option-button:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .option-button.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .option-button.cardio.selected {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #f59e0b;
        }

        .option-button.strength.selected {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
        }

        .option-button.rest.selected {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            border-color: #6366f1;
        }

        .steps-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .steps-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .steps-text {
            font-size: 1em;
            color: #333;
        }

        .save-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .save-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .view-tabs {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .tab-button {
            flex: 1;
            padding: 12px;
            background: #f3f4f6;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .view-content {
            display: none;
        }

        .view-content.active {
            display: block;
        }

        .calendar {
            margin-top: 20px;
        }

        .calendar-header {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-navigation {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-button {
            background: #667eea;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .nav-button:hover {
            background: #5568d3;
            transform: scale(1.1);
        }

        .nav-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .month-label {
            font-size: 1.1em;
            font-weight: 600;
            min-width: 150px;
            text-align: center;
        }

        .week-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 5px;
        }

        .day-label {
            text-align: center;
            font-size: 0.8em;
            color: #999;
            font-weight: 600;
            padding: 8px 0;
        }

        .day-cell {
            /* FIX: min-width: 0 prevents grid cells from blowing out due to content */
            min-width: 0;
            aspect-ratio: 1;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 600;
            position: relative;
            background: #f3f4f6;
            color: #9ca3af;
            padding: 4px 2px;
            overflow: hidden;
        }

        .day-cell.has-data {
            background: white;
            border: 2px solid #e5e7eb;
            color: #333;
        }

        .day-cell.today {
            border: 3px solid #667eea;
        }

        .day-cell.future {
            opacity: 0.4;
            cursor: default !important;
        }

        /* Clickable past/present cells */
        .day-cell.clickable {
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .day-cell.clickable:hover {
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            z-index: 1;
        }

        /* Currently selected day being edited */
        .day-cell.editing {
            border: 3px solid #f59e0b !important;
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.3);
        }

        .day-number {
            font-size: 0.95em;
            margin-bottom: 1px;
            line-height: 1;
        }

        .day-icons {
            display: flex;
            gap: 1px;
            font-size: 0.7em;
            flex-wrap: wrap;
            justify-content: center;
            /* FIX: constrain icons so they never push cell width */
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .day-icons span {
            display: inline-block;
            line-height: 1;
        }

        .icon-cardio { color: #f59e0b; }
        .icon-strength { color: #10b981; }
        .icon-rest { color: #6366f1; }
        .icon-steps { color: #8b5cf6; }

        .stats-section {
            margin-top: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .reset-button {
            margin-top: 20px;
            text-align: center;
        }

        .reset-button button {
            background: none;
            border: 2px solid #ef4444;
            color: #ef4444;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .reset-button button:hover {
            background: #ef4444;
            color: white;
        }

        .completed-banner {
            background: #d1fae5;
            color: #065f46;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí™ Fitness Tracker</h1>
        
        <div class="today-section">
            <div class="today-header" id="todayHeader">
                Today
                <div class="editing-hint" id="editingHint" style="display:none;">Tap any day on the calendar to edit it</div>
            </div>
            
            <div id="completedBanner" class="completed-banner" style="display: none;">
                ‚úì Activity logged!
            </div>

            <div class="input-group">
                <label class="input-label">Workout Type</label>
                <div class="button-group">
                    <button class="option-button cardio" onclick="selectWorkoutType('cardio', this)">
                        üèÉ Cardio
                    </button>
                    <button class="option-button strength" onclick="selectWorkoutType('strength', this)">
                        üèãÔ∏è Strength
                    </button>
                    <button class="option-button rest" onclick="selectWorkoutType('rest', this)">
                        üòå Rest Day
                    </button>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Steps</label>
                <div class="steps-input">
                    <input type="checkbox" id="stepsCheckbox" class="steps-checkbox">
                    <label for="stepsCheckbox" class="steps-text">Hit 7,000+ steps today</label>
                </div>
            </div>

            <button class="save-button" onclick="saveEntry()" id="saveButton">
                Save Today
            </button>
        </div>

        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="cardioCount">0</div>
                    <div class="stat-label">Cardio Days (7d)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="strengthCount">0</div>
                    <div class="stat-label">Strength Days (7d)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="stepsCount">0</div>
                    <div class="stat-label">Days 7k+ Steps (7d)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="restCount">0</div>
                    <div class="stat-label">Rest Days (7d)</div>
                </div>
            </div>
        </div>

        <div class="view-tabs">
            <button class="tab-button active" onclick="switchView('weekly', this)">Weekly</button>
            <button class="tab-button" onclick="switchView('monthly', this)">Monthly</button>
        </div>

        <div id="weeklyView" class="view-content active">
            <div class="calendar">
                <div class="calendar-header">Last 4 Weeks</div>
                <div class="week-row">
                    <div class="day-label">Sun</div>
                    <div class="day-label">Mon</div>
                    <div class="day-label">Tue</div>
                    <div class="day-label">Wed</div>
                    <div class="day-label">Thu</div>
                    <div class="day-label">Fri</div>
                    <div class="day-label">Sat</div>
                </div>
                <div id="calendarGrid"></div>
            </div>
        </div>

        <div id="monthlyView" class="view-content">
            <div class="calendar">
                <div class="calendar-header">
                    <div class="month-navigation">
                        <button class="nav-button" onclick="changeMonth(-1)">‚Äπ</button>
                        <div class="month-label" id="monthLabel"></div>
                        <button class="nav-button" id="nextMonthBtn" onclick="changeMonth(1)">‚Ä∫</button>
                    </div>
                </div>
                <div class="week-row">
                    <div class="day-label">Sun</div>
                    <div class="day-label">Mon</div>
                    <div class="day-label">Tue</div>
                    <div class="day-label">Wed</div>
                    <div class="day-label">Thu</div>
                    <div class="day-label">Fri</div>
                    <div class="day-label">Sat</div>
                </div>
                <div id="monthlyCalendarGrid"></div>
            </div>
        </div>

        <div class="reset-button">
            <button onclick="resetData()">Reset All Data</button>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'fitnessTrackerData';
        let selectedWorkoutType = null;
        let currentViewMonth = new Date();
        // Track which date is currently loaded in the editor (defaults to today)
        let editingDateStr = getTodayString();

        function getStoredData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function getDateString(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function getTodayString() {
            return getDateString(new Date());
        }

        function formatDateForHeader(dateStr) {
            const [y, m, d] = dateStr.split('-').map(Number);
            const date = new Date(y, m - 1, d);
            const today = getTodayString();
            if (dateStr === today) return 'Today';
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (dateStr === getDateString(yesterday)) return 'Yesterday';
            return date.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
        }

        function selectWorkoutType(type, btn) {
            selectedWorkoutType = type;
            document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        // Load a date's data into the editor form
        function loadDateIntoEditor(dateStr) {
            editingDateStr = dateStr;
            const data = getStoredData();
            const entry = data[dateStr];

            // Update header
            document.getElementById('todayHeader').childNodes[0].textContent = formatDateForHeader(dateStr);
            document.getElementById('editingHint').style.display = 'block';

            // Update save button label
            const isToday = dateStr === getTodayString();
            document.getElementById('saveButton').textContent = isToday ? 'Save Today' : 'Save Entry';

            // Reset form
            selectedWorkoutType = null;
            document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            document.getElementById('stepsCheckbox').checked = false;

            if (entry) {
                document.getElementById('completedBanner').style.display = 'block';
                document.getElementById('stepsCheckbox').checked = entry.steps;
                selectedWorkoutType = entry.workoutType;
                const btn = document.querySelector(`.option-button.${entry.workoutType}`);
                if (btn) btn.classList.add('selected');
            } else {
                document.getElementById('completedBanner').style.display = 'none';
            }

            // Redraw calendars to highlight the selected date
            renderCalendar();
            renderMonthlyCalendar();

            // Scroll up to editor
            document.querySelector('.today-section').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function saveEntry() {
            if (!selectedWorkoutType) {
                alert('Please select a workout type!');
                return;
            }

            const data = getStoredData();
            const steps = document.getElementById('stepsCheckbox').checked;

            data[editingDateStr] = {
                workoutType: selectedWorkoutType,
                steps: steps
            };

            saveData(data);
            updateUI();
        }

        function switchView(view, btn) {
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            document.querySelectorAll('.view-content').forEach(c => c.classList.remove('active'));

            if (view === 'weekly') {
                document.getElementById('weeklyView').classList.add('active');
            } else {
                document.getElementById('monthlyView').classList.add('active');
                currentViewMonth = new Date();
                renderMonthlyCalendar();
            }
        }

        function changeMonth(direction) {
            currentViewMonth.setMonth(currentViewMonth.getMonth() + direction);
            renderMonthlyCalendar();
        }

        function buildDayCell(dateStr, dayNumber, isFuture) {
            const data = getStoredData();
            const dayData = data[dateStr];
            const isToday = dateStr === getTodayString();
            const isEditing = dateStr === editingDateStr;

            const cell = document.createElement('div');
            cell.className = 'day-cell';

            if (dayData) cell.classList.add('has-data');
            if (isToday) cell.classList.add('today');
            if (isEditing) cell.classList.add('editing');

            if (!isFuture) {
                cell.classList.add('clickable');
                cell.onclick = () => loadDateIntoEditor(dateStr);
            } else {
                cell.classList.add('future');
            }

            const num = document.createElement('div');
            num.className = 'day-number';
            num.textContent = dayNumber;
            cell.appendChild(num);

            if (dayData) {
                const icons = document.createElement('div');
                icons.className = 'day-icons';

                if (dayData.workoutType === 'cardio') {
                    icons.innerHTML += '<span class="icon-cardio">üèÉ</span>';
                } else if (dayData.workoutType === 'strength') {
                    icons.innerHTML += '<span class="icon-strength">üèãÔ∏è</span>';
                } else if (dayData.workoutType === 'rest') {
                    icons.innerHTML += '<span class="icon-rest">üòå</span>';
                }

                if (dayData.steps) {
                    icons.innerHTML += '<span class="icon-steps">üëü</span>';
                }

                cell.appendChild(icons);
            }

            return cell;
        }

        function renderMonthlyCalendar() {
            const grid = document.getElementById('monthlyCalendarGrid');
            grid.innerHTML = '';

            const today = new Date();
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('monthLabel').textContent = `${monthNames[month]} ${year}`;

            const nextMonthBtn = document.getElementById('nextMonthBtn');
            nextMonthBtn.disabled = (year === today.getFullYear() && month === today.getMonth());

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let currentRow = document.createElement('div');
            currentRow.className = 'week-row';

            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'day-cell';
                currentRow.appendChild(empty);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const currentDate = new Date(year, month, day);
                const dateStr = getDateString(currentDate);
                const isFuture = currentDate > today && dateStr !== getTodayString();

                currentRow.appendChild(buildDayCell(dateStr, day, isFuture));

                if ((firstDay + day) % 7 === 0) {
                    grid.appendChild(currentRow);
                    currentRow = document.createElement('div');
                    currentRow.className = 'week-row';
                }
            }

            if (currentRow.children.length > 0) {
                while (currentRow.children.length < 7) {
                    const empty = document.createElement('div');
                    empty.className = 'day-cell';
                    currentRow.appendChild(empty);
                }
                grid.appendChild(currentRow);
            }
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const today = new Date();
            const startDate = new Date(today);
            startDate.setDate(today.getDate() - 27);

            const startDay = startDate.getDay();

            let currentRow = document.createElement('div');
            currentRow.className = 'week-row';

            for (let i = 0; i < startDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'day-cell';
                currentRow.appendChild(empty);
            }

            for (let i = 0; i < 28; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                const dateStr = getDateString(currentDate);

                currentRow.appendChild(buildDayCell(dateStr, currentDate.getDate(), false));

                if ((startDay + i + 1) % 7 === 0) {
                    grid.appendChild(currentRow);
                    currentRow = document.createElement('div');
                    currentRow.className = 'week-row';
                }
            }

            if (currentRow.children.length > 0) {
                grid.appendChild(currentRow);
            }
        }

        function updateUI() {
            const data = getStoredData();
            const entry = data[editingDateStr];

            // Update form to reflect current editing date
            document.getElementById('todayHeader').childNodes[0].textContent = formatDateForHeader(editingDateStr);
            const isToday = editingDateStr === getTodayString();
            document.getElementById('saveButton').textContent = isToday ? 'Save Today' : 'Save Entry';

            document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            selectedWorkoutType = null;

            if (entry) {
                document.getElementById('completedBanner').style.display = 'block';
                document.getElementById('stepsCheckbox').checked = entry.steps;
                selectedWorkoutType = entry.workoutType;
                const btn = document.querySelector(`.option-button.${entry.workoutType}`);
                if (btn) btn.classList.add('selected');
            } else {
                document.getElementById('completedBanner').style.display = 'none';
                document.getElementById('stepsCheckbox').checked = false;
            }

            // Stats
            const stats = calculateStats(7);
            document.getElementById('cardioCount').textContent = stats.cardio;
            document.getElementById('strengthCount').textContent = stats.strength;
            document.getElementById('stepsCount').textContent = stats.steps;
            document.getElementById('restCount').textContent = stats.rest;

            renderCalendar();
            renderMonthlyCalendar();
        }

        function calculateStats(days) {
            const data = getStoredData();
            const today = new Date();
            const stats = { cardio: 0, strength: 0, steps: 0, rest: 0 };

            for (let i = 0; i < days; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = getDateString(date);
                const dayData = data[dateStr];

                if (dayData) {
                    if (dayData.workoutType === 'cardio') stats.cardio++;
                    if (dayData.workoutType === 'strength') stats.strength++;
                    if (dayData.workoutType === 'rest') stats.rest++;
                    if (dayData.steps) stats.steps++;
                }
            }

            return stats;
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all your fitness data? This cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                selectedWorkoutType = null;
                editingDateStr = getTodayString();
                updateUI();
            }
        }

        // Set the editing hint visible on load since it's always useful to know
        document.getElementById('editingHint').style.display = 'block';

        // Initialize
        updateUI();
    </script>
</body>
</html>
